<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Traces of Control — Grid + Snap + Overlap</title>
<style>
:root{--cols:10;--rows:2;--gap:14px;--pad:clamp(12px,2vw,30px);--ink:#0f172a;}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:system-ui,-apple-system,"PingFang SC",Arial,sans-serif;background:#f5f7fb;color:var(--ink)}
.container{min-height:100svh;padding:var(--pad);display:grid}


.scene{display:none;opacity:0;transform:translateY(10px);transition:.35s}
.scene.active{display:block;opacity:1;transform:translateY(0)}

/* Scene 1 */
.board{
  display:grid;grid-template-columns:repeat(var(--cols),1fr);
  grid-auto-rows:160px;gap:var(--gap);height:80vh;background:#fff;border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);position:relative;padding:var(--gap)
}
.chip{
  display:grid;grid-template-rows:1fr auto;align-content:start;border-radius:16px;overflow:hidden;
  box-shadow:0 8px 22px rgba(0,0,0,.12);cursor:grab;user-select:none;touch-action:none;position:relative;
  transform:translate(var(--jx,0px),var(--jy,0px))
}
.chip img{width:100%;height:100%;object-fit:cover;display:block;-webkit-user-drag:none}
.chip figcaption{font-size:12px;color:#475569;background:rgba(255,255,255,.86);padding:4px 8px;border-radius:8px;margin:6px;justify-self:start}
.chip.s{grid-column:span 1;grid-row:span 1}
.chip.m{grid-column:span 2;grid-row:span 2}
.chip.l{grid-column:span 3;grid-row:span 2}
.red{position:relative}
.red::after{content:"";position:absolute;top:10px;right:10px;width:44px;height:44px;background:#ef4444;border-radius:50%;box-shadow:0 0 0 0 rgba(239,68,68,.55);animation:pulse 1.2s infinite}
@keyframes pulse{70%{box-shadow:0 0 0 44px rgba(239,68,68,0)}100%{box-shadow:0 0 0 0 rgba(239,68,68,0)}}

/* Scene 2 */
.board2{display:grid;grid-template-columns:1fr .5fr 1fr;gap:12px;width:min(1200px,94vw);min-height:90vh;margin:0 auto}
.col{background:#fff;border-radius:10px;padding:8px;box-shadow:0 6px 20px rgba(0,0,0,.08);
  display:grid;grid-template-columns:repeat(3,1fr);grid-auto-rows:minmax(110px,auto);gap:8px}
.card{grid-column:span 3;min-height:160px;display:grid;grid-template-rows:1fr auto;background:#f8fafc;border-radius:8px;overflow:hidden}
.card img{width:100%;height:100%;object-fit:cover;display:block;grid-row:1}
.card figcaption{padding:6px 8px;font-size:12px;color:#334155;background:#fff}
.card[data-remove]{outline:2px dashed rgba(2,132,199,.28);cursor:pointer}
.card--text{background:#fff;border:1px solid #e5e7eb;grid-template-rows:auto 1fr}
.card-text__title{font-weight:600;font-size:14px;padding:8px 10px;border-bottom:1px solid #e5e7eb;color:#0f172a}
.card-text__body{padding:10px 12px;font-size:14px;line-height:1.6;color:#334155;overflow:auto;white-space:pre-wrap}

/* Scene 3 */
.grid3{
  display:grid;gap:var(--gap);min-height:90svh;width:min(1200px,94vw);margin:0 auto;
  grid-template-columns:2fr 1.2fr .9fr 1.6fr;grid-template-rows:repeat(8,11vh);
  grid-template-areas:
    "A A B C" "A A B C" "A A B C" "D D B C"
    "D D E E" "D D E E" "F F E E" "F F E E";
}
.island{background:#fff;border-radius:18px;padding:10px;box-shadow:0 10px 30px rgba(0,0,0,.08);position:relative;overflow:hidden}
.A{grid-area:A}.B{grid-area:B}.C{grid-area:C}.D{grid-area:D}.E{grid-area:E}.F{grid-area:F}


.float{position:absolute;transform:translate(-50%,-50%) rotate(var(--rot,0deg));cursor:grab;user-select:none;touch-action:none}
.float img{width:clamp(110px,18vw,220px);border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.16);-webkit-user-drag:none}
.float.fit{position:absolute;inset:10px;transform:none;cursor:default}
.float.fit img{width:100%;height:100%;object-fit:cover;display:block;border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.12)}


.bill-pad{position:absolute;inset:10px;background:#fff;border-radius:14px;border:1px solid #e5e7eb;padding:12px 14px;overflow:auto;box-shadow:0 4px 14px rgba(0,0,0,.06)}
.bill-pad h3{margin:0 0 8px;font-size:15px;color:#0f172a}
.bill-pad p{margin:0 0 8px;font-size:14px;line-height:1.6;color:#334155}
.bill-pad pre{margin:8px 0 0;font:13px ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#f8fafc;border:1px dashed #e2e8f0;border-radius:8px;padding:8px 10px;white-space:pre-wrap}

/* selfie animation */
.float.echo{animation:pop .55s ease both;opacity:.98}
@keyframes pop{0%{transform:translate(-50%,-50%) scale(.55) rotate(var(--rot,0deg));filter:blur(2px);opacity:0}
60%{transform:translate(-50%,-50%) scale(1.06) rotate(var(--rot,0deg));opacity:1}
100%{transform:translate(-50%,-50%) scale(1) rotate(var(--rot,0deg));filter:blur(0)}}


@media(max-width:700px){.board{height:68vh}.chip.l{grid-column:span 2;grid-row:span 2}}
</style>
</head>
<body>
<div class="container">
  <!-- Scene 1 -->
  <section id="scene1" class="scene active" aria-label="Scene 1">
    <main class="board" id="board"></main>
  </section>

  <!-- Scene 2 -->
  <section id="scene2" class="scene" aria-label="Scene 2">
    <main class="board2" id="board2">
      <section class="col">
        <figure class="card"><img src="images/20.jpg" alt=""><figcaption>Story</figcaption></figure>
        <figure class="card"><img src="images/12.jpg" alt=""><figcaption>Saved</figcaption></figure>
        <figure class="card card--text">
          <header class="card-text__title">Note</header>
          <div class="card-text__body" contenteditable="true">在这里写你的笔记。支持多段落，超出滚动，点击即可编辑。</div>
        </figure>
        <figure class="card"><img src="images/21.jpg" alt=""><figcaption>Like</figcaption></figure>
      </section>
      <section class="col">
        <figure class="card" data-remove><img src="images/18.jpg" alt=""><figcaption>Remove</figcaption></figure>
        <figure class="card"><img src="images/19.jpg" alt=""><figcaption>DM</figcaption></figure>
        <figure class="card" data-remove><img src="images/20.jpg" alt=""><figcaption>Remove</figcaption></figure>
      </section>
      <section class="col">
        <figure class="card"><img src="images/11.jpg" alt=""><figcaption>Fashion Ad</figcaption></figure>
        <figure class="card"><img src="images/5.jpg"  alt=""><figcaption>Fitness Ad</figcaption></figure>
        <figure class="card"><img src="images/9.jpg"  alt=""><figcaption>Travel Ad</figcaption></figure>
      </section>
    </main>
  </section>

  <!-- Scene 3 -->
  <section id="scene3" class="scene" aria-label="Scene 3">
    <main class="grid3" id="grid3">
      <section class="island A"></section>
      <section class="island B"></section>
      <section class="island C"></section>
      <section class="island D"></section>
      <section class="island E"></section>
      <section class="island F"></section>
    </main>
  </section>
</div>

<script>

const $=s=>document.querySelector(s);
const $$=s=>[...document.querySelectorAll(s)];
const SCENES={s1:$('#scene1'),s2:$('#scene2'),s3:$('#scene3')};
const show=sc=>Object.values(SCENES).forEach(s=>s.classList.toggle('active',s===sc));

/* Scene 1 */
const board=$('#board');
const COLS=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cols'))||5;
let zTop=10;
const SIZE_SET=[['m'],['l'],['s'],['m'],['s']];
const jitter=px=>((Math.random()*2-1)*px).toFixed(1)+'px';

for(let i=1;i<=20;i++) addChip(i);
function addChip(i){
  const [klass]=SIZE_SET[Math.floor(Math.random()*SIZE_SET.length)];
  const fig=document.createElement('figure'); fig.className=`chip ${klass}`+(i===1?' red':'');
  fig.style.setProperty('--jx',jitter(6)); fig.style.setProperty('--jy',jitter(6));
  const img=document.createElement('img'); img.src=`images/${i}.jpg`; img.alt='';
  fig.appendChild(img); board.appendChild(fig);

  fig.addEventListener('pointerdown',e=>{
    fig.setPointerCapture(e.pointerId); fig.style.zIndex=++zTop;
    const b=board.getBoundingClientRect(), gap=parseInt(getComputedStyle(board).gap)||0;
    const cellW=(b.width-(COLS-1)*gap)/COLS, cellH=parseInt(getComputedStyle(board).gridAutoRows)||160;
    const move=ev=>{
      const cx=Math.max(0,Math.min(b.width,ev.clientX-b.left));
      const cy=Math.max(0,Math.min(b.height,ev.clientY-b.top));
      let col=Math.round(cx/(cellW+gap))+1, row=Math.round(cy/(cellH+gap))+1;
      fig.style.gridColumnStart=Math.max(1,Math.min(COLS,col));
      fig.style.gridRowStart=Math.max(1,row);
    };
    const up=()=>{fig.releasePointerCapture(e.pointerId);fig.removeEventListener('pointermove',move);fig.removeEventListener('pointerup',up)};
    fig.addEventListener('pointermove',move); fig.addEventListener('pointerup',up);
  });
}
document.addEventListener('click',e=>{
  const r=e.target.closest('.chip.red');
  if(r && SCENES.s1.classList.contains('active')) show(SCENES.s2);
});

/* Scene 2 */
const board2=$('#board2'); let removeClicks=0;
board2.addEventListener('click',e=>{
  const card=e.target.closest('.card'); if(!card || card.classList.contains('card--text')) return;
  if(card.hasAttribute('data-remove')){
    removeClicks++; card.style.opacity=.65; if(removeClicks>=2) show(SCENES.s3); return;
  }
  const next=((card.dataset.span||'1x1')==='1x1')?'2x1':(card.dataset.span==='2x1')?'1x2':(card.dataset.span==='1x2')?'2x2':'1x1';
  card.dataset.span=next; const [w,h]=next.split('x').map(Number);
  card.style.gridColumn=`span ${w}`; card.style.gridRow=`span ${h}`;
});

/* Scene 3 */
const el=html=>{const t=document.createElement('template');t.innerHTML=html.trim();return t.content.firstChild;}
function enableDrag(node){
  node.addEventListener('pointerdown',e=>{
    node.setPointerCapture(e.pointerId);
    const box=node.closest('.island'), R=box.getBoundingClientRect();
    const startL=(parseFloat(node.style.left||'50%')/100)*R.width;
    const startT=(parseFloat(node.style.top ||'50%')/100)*R.height;
    const dx=e.clientX-startL, dy=e.clientY-startT;
    const move=ev=>{
      const nx=(ev.clientX-dx)/R.width, ny=(ev.clientY-dy)/R.height;
      node.style.left=(Math.min(.95,Math.max(.05,nx))*100)+'%';
      node.style.top =(Math.min(.95,Math.max(.05,ny))*100)+'%';
    };
    const up=()=>{node.releasePointerCapture(e.pointerId);node.removeEventListener('pointermove',move);node.removeEventListener('pointerup',up)};
    node.addEventListener('pointermove',move); node.addEventListener('pointerup',up);
  });
}
function addFloat(container,src,cls=''){
  if(cls.includes('fit')){
    const n=el(`<figure class="float fit"><img src="${src}" alt=""></figure>`); container.appendChild(n); return n;
  }
  const x=Math.random()*0.8+0.1, y=Math.random()*0.8+0.1, rot=(Math.random()*10-5).toFixed(1);
  const n=el(`<figure class="float" style="left:${x*100}%;top:${y*100}%;--rot:${rot}deg"><img src="${src}" alt=""></figure>`);
  container.appendChild(n); enableDrag(n); return n;
}


const ABox=$('.A'); const baseSelfie=addFloat(ABox,'images/2.jpg','fit');
[['.B','images/1.jpg'],['.C','images/5.jpg'],['.D','images/9.jpg'],['.F','images/15.jpg']].forEach(([sel,src])=>addFloat($(sel),src,'fit'));

const E=$('.E');
E.innerHTML+=`<article class="bill-pad">
  <h3>Data Overload</h3>
  <p>在这里写“账单/收据”的说明：来源、时间、金额、备注等。</p>
  <pre>2024-10-02  Zara   ¥169.00
2024-10-05  Nike   ¥329.00
2024-10-09  Coffee  ¥28.00
Total: ¥526.00</pre>
</article>`;

/* selfie echo */
function selfieEcho(container,src,count=16){
  for(let i=0;i<count;i++){
    const x=Math.random()*0.84+0.08, y=Math.random()*0.84+0.08, rot=(Math.random()*24-12).toFixed(1);
    const n=el(`<figure class="float echo" style="left:${(x*100).toFixed(2)}%;top:${(y*100).toFixed(2)}%;--rot:${rot}deg"><img src="${src}" alt="self clone"></figure>`);
    container.appendChild(n); enableDrag(n);
  }
}
ABox.addEventListener('click',()=>selfieEcho(ABox,'images/2.jpg',16));
</script>
</body>
</html>
